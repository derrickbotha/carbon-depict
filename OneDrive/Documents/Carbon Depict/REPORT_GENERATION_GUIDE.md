# Report Generation with Date Ranges

This document explains how to use the enhanced report generation features that include date range filtering and automatic addendum inclusion.

## Features

### 1. Date Range Pre-population in Custom Forms
- When selecting "Custom range" in the DateFilter component, the start and end date inputs are automatically populated with the currently selected dates
- Dates appear in black text in the standard date input format (YYYY-MM-DD)
- Users can modify the pre-filled dates or keep them as-is

### 2. Report Generation with Date Ranges
- Generate reports that include specific date ranges
- Automatic addendum inclusion at the bottom of downloaded reports
- Support for multiple formats: PDF, Excel, CSV

## API Endpoints

### Generate Report with Date Range
```javascript
POST /api/reports/generate-with-dates
```

**Request Body:**
```json
{
  "type": "annual",
  "framework": "GRI",
  "period": "2024",
  "startDate": "2024-01-01",
  "endDate": "2024-12-31",
  "data": {
    "summary": "Report content",
    "metrics": "ESG metrics data"
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "1234567890",
    "name": "GRI Annual Report - 2024",
    "type": "annual",
    "framework": "GRI",
    "period": "2024",
    "dateRange": "January 1, 2024 - December 31, 2024",
    "startDate": "2024-01-01",
    "endDate": "2024-12-31",
    "status": "generated",
    "createdAt": "2024-01-15T10:30:00.000Z",
    "content": {
      "summary": "Generated GRI Annual report for January 1, 2024 - December 31, 2024",
      "data": {...},
      "addendum": {
        "reportPeriod": "January 1, 2024 - December 31, 2024",
        "generatedOn": "January 15, 2024 at 10:30 AM",
        "dataRange": "January 1, 2024 - December 31, 2024",
        "framework": "GRI",
        "reportType": "annual",
        "startDate": "2024-01-01",
        "endDate": "2024-12-31"
      }
    }
  },
  "message": "Report generated successfully for period January 1, 2024 - December 31, 2024"
}
```

### Download Report with Date Range
```javascript
GET /api/reports/:id/download/:format?startDate=2024-01-01&endDate=2024-12-31
```

**Query Parameters:**
- `startDate`: Start date in YYYY-MM-DD format
- `endDate`: End date in YYYY-MM-DD format

**Response:** File download with addendum included

## Frontend Usage

### Using the ReportGenerator Component

```jsx
import ReportGenerator from '../components/ReportGenerator'

const MyDashboard = () => {
  const [dateRange, setDateRange] = useState({
    startDate: new Date('2024-01-01'),
    endDate: new Date('2024-12-31')
  })

  const handleReportGenerated = (report) => {
    console.log('Report generated:', report)
    // Handle successful report generation
  }

  return (
    <div>
      <ReportGenerator 
        dateRange={dateRange}
        onReportGenerated={handleReportGenerated}
      />
    </div>
  )
}
```

### Using the Enterprise API

```javascript
import { enterpriseAPI } from '../services/enterpriseAPI'

// Generate report with date range
const generateReport = async (dateRange) => {
  try {
    const reportData = {
      type: 'annual',
      framework: 'GRI',
      period: '2024',
      startDate: dateRange.startDate.toISOString().split('T')[0],
      endDate: dateRange.endDate.toISOString().split('T')[0],
      data: {
        // Your report data
      }
    }

    const response = await enterpriseAPI.reports.generateWithDates(reportData)
    return response.data
  } catch (error) {
    console.error('Error generating report:', error)
  }
}

// Download report with date range
const downloadReport = async (reportId, format, dateRange) => {
  try {
    const params = {
      startDate: dateRange.startDate.toISOString().split('T')[0],
      endDate: dateRange.endDate.toISOString().split('T')[0]
    }

    const response = await enterpriseAPI.reports.download(reportId, format, params)
    
    // Create blob and download
    const blob = new Blob([response.data])
    const url = window.URL.createObjectURL(blob)
    const link = document.createElement('a')
    link.href = url
    link.download = `report-${reportId}.${format}`
    document.body.appendChild(link)
    link.click()
    document.body.removeChild(link)
    window.URL.revokeObjectURL(url)
  } catch (error) {
    console.error('Error downloading report:', error)
  }
}
```

## Report Addendum Format

The addendum is automatically included at the bottom of all downloaded reports and contains:

```
REPORT ADDENDUM
===============

Report Period: January 1, 2024 - December 31, 2024
Generated On: January 15, 2024 at 10:30 AM
Data Range: January 1, 2024 - December 31, 2024
Report ID: 1234567890

This report contains data for the period January 1, 2024 - December 31, 2024.
Generated by Carbon Depict ESG Management System.
```

## Supported Frameworks

- **GRI** (Global Reporting Initiative)
- **TCFD** (Task Force on Climate-related Financial Disclosures)
- **SBTi** (Science Based Targets initiative)
- **CSRD** (Corporate Sustainability Reporting Directive)
- **SDG** (Sustainable Development Goals)
- **CDP** (Carbon Disclosure Project)

## Supported Formats

- **PDF** (.pdf)
- **Excel** (.xlsx)
- **CSV** (.csv)

## Error Handling

The API includes proper error handling for:
- Invalid date ranges (start date after end date)
- Missing required parameters
- Authentication and authorization errors
- File generation errors

## Best Practices

1. **Always validate date ranges** before generating reports
2. **Use consistent date formats** (YYYY-MM-DD) across the application
3. **Handle loading states** when generating reports
4. **Provide user feedback** for successful report generation
5. **Include error handling** for failed report generation attempts
